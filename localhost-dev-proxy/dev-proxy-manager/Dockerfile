FROM envoyproxy/envoy:v1.24.0

ENV JAVA_HOME=/opt/java/openjdk
COPY --from=eclipse-temurin:17 $JAVA_HOME $JAVA_HOME
ENV PATH="${JAVA_HOME}/bin:${PATH}"

ARG APPLICATION_ARCHIVE_FILE_NAME
ARG APPLICATION_JAR_FILE_NAME
ARG APPLICATION_FOLDER_NAME

ADD $APPLICATION_ARCHIVE_FILE_NAME /app

ADD $APPLICATION_JAR_FILE_NAME /app/$APPLICATION_FOLDER_NAME/lib

WORKDIR /app/$APPLICATION_FOLDER_NAME

ENV ENVOY_UID=0
ENV ENVOY_GID=0
EXPOSE 9990
EXPOSE 9998
EXPOSE 9999

CMD ["bin/localhost-server-manager"]
